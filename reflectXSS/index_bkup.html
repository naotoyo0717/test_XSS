<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>XSSテスト</title>
</head>
<body>
  <h1>反射型XSS</h1>

  <form method="GET" action="index.html">
    <label for="q">検索:</label>
    <input type="text" id="q" name="q">
    <button type="submit">検索</button>
  </form>

  <h2>検索結果</h2>
  <p>検索ワード: <span id="output"></span></p>

  <p>入力（エスケープ前）: <span id="raw"></span></p>
  <p>表示（エスケープ後）: <span id="output"></span></p>

  <script>
    const params = new URLSearchParams(location.search);
    const query = params.get("q");

    function escapeHTML(str) {
    return str
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
    }
    console.log({query});
	/*   エスケープ処理 */

    if (query) {
	document.getElementById("raw").textContent = query;
      	//document.getElementById("output").innerHTML = query;
	//XSS発生
	//document.getElementById("output").textContent = query;
	//textContentを用いてHTMLに翻訳されないようにする。
	document.getElementById("output").innerHTML = escapeHTML(query);
	//エスケープ処理
    }
  </script>
</body>
</html>

